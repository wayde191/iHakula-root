<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2001-2009, TIBCO Software Inc.
  ~ Use, modification, and distribution subject to terms of license.
  -->
<plugins xmlns="http://www.generalinterface.org/gi/amp" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.generalinterface.org/gi/amp http://www.generalinterface.org/xsd/plugins.xsd">

  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.HotKey"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Heavyweight"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Interactive">
    <requires>
      <plugin id="jsx3.gui.HotKey"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Painted"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Block">
    <requires>
      <plugin id="jsx3.gui.Interactive"/>
      <plugin id="jsx3.gui.Painted"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.app.UserSettings"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.net.Form"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.xml.Cacheable"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Form"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Alerts"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.BlockX">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.xml.Cacheable"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.ToolbarButton">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.WindowBar">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Dialog">
    <requires>
      <plugin id="jsx3.gui.Alerts"/>
      <plugin id="jsx3.gui.ToolbarButton"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Button">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.TextBox">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.NumberInput">
    <requires>
      <plugin id="jsx3.gui.TextBox"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.CheckBox">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.RadioButton">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Splitter">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.LayoutGrid">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Stack">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.StackGroup">
    <requires>
      <plugin id="jsx3.gui.LayoutGrid"/>
      <plugin id="jsx3.gui.Stack"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Tab">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.TabbedPane">
    <requires>
      <plugin id="jsx3.gui.Tab"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Select">
    <requires>
      <plugin id="jsx3.gui.Heavyweight"/>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.xml.Cacheable"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Menu">
    <requires>
      <plugin id="jsx3.gui.Heavyweight"/>
      <plugin id="jsx3.xml.Cacheable"/>
      <plugin id="jsx3.gui.Form"/>
      <plugin id="jsx3.gui.ToolbarButton"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Tree">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.xml.Cacheable"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.DatePicker">
    <requires>
      <plugin id="jsx3.gui.Heavyweight"/>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Slider">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Sound">
    <requires>
      <plugin id="jsx3.gui.Interactive"/>
      <plugin id="jsx3.gui.Painted"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Window"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.ImageButton">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.ColorPicker">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.TimePicker">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Matrix.Column">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Matrix">
    <requires>
      <plugin id="jsx3.xml.Cacheable"/>
      <plugin id="jsx3.gui.Form"/>
      <plugin id="jsx3.gui.Matrix.Column"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Image">
    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.net.Service"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Table">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.xml.Cacheable"/>
      <plugin id="jsx3.gui.Form"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.html.DOM"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.html.Style"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.Template">
    <requires>
      <plugin id="jsx3.gui.Block"/>
      <plugin id="jsx3.html.DOM"/>
      <plugin id="jsx3.html.Style"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.util.Dojo"/>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.xml.DojoDataStore">
    <requires>
      <plugin id="jsx3.util.Dojo"/>
    </requires>
  </plugin>
  <plugin class="jsx3.amp.ClassPlugIn" id="jsx3.gui.DojoWidget">
    <requires>
      <plugin id="jsx3.util.Dojo"/>
      <plugin id="jsx3.gui.Block"/>
    </requires>
  </plugin>

  <plugin id="jsx3.gui.Alerts.alert">
    <requires>
      <plugin id="jsx3.gui.Button"/>
      <plugin id="jsx3.gui.Alerts"/>
    </requires>
    <resources>
      <xml cache="shared" cachekey="JSX/xml/components/dialog_alert.xml" id="xml" path="jsx:/xml/components/dialog_alert.xml"/>
    </resources>
  </plugin>
  <plugin id="jsx3.gui.Alerts.confirm">
    <requires>
      <plugin id="jsx3.gui.Button"/>
      <plugin id="jsx3.gui.Alerts"/>
    </requires>
    <resources>
      <xml cache="shared" cachekey="JSX/xml/components/dialog_confirm.xml" id="xml" path="jsx:/xml/components/dialog_confirm.xml"/>
    </resources>
  </plugin>
  <plugin id="jsx3.gui.Alerts.prompt">
    <requires>
      <plugin id="jsx3.gui.Button"/>
      <plugin id="jsx3.gui.Alerts"/>
    </requires>
    <resources>
      <xml cache="shared" cachekey="JSX/xml/components/dialog_prompt.xml" id="xml" path="jsx:/xml/components/dialog_prompt.xml"/>
    </resources>
  </plugin>

  <plugin class="jsx3.amp.Main" id="jsx3.amp.main" name="Controller Plug-In" version="0.1">

    <requires>
      <plugin id="jsx3.gui.Block"/>
    </requires>

    <resources>
      <script id="Main" load="early">
        <data><![CDATA[/*
 * Copyright (c) 2001-2009, TIBCO Software Inc.
 * Use, modification, and distribution subject to terms of license.
 */

/**
 * @package
 */
jsx3.lang.Class.defineClass("jsx3.amp.Main", jsx3.amp.PlugIn, null, function(Main, Main_prototype) {

  var amp = jsx3.amp;
  
  Main_prototype.onRegister = function() {
    amp.LOG.debug("Main.onRegister");
    this._progress = jsx3.$A();
    this._pctdone = 0;
    this._mainComp = null;
    
    this.getEngine().subscribe(amp.Engine.PROGRESS, this, "_onProgress");
    this.load();
    // Since this is the first plug-in to load, no need to check pre-existing extensions.
  };

  Main_prototype.onExtension = function(objExtPt, arrExts) {
    this.jsxsuper(objExtPt, arrExts);

    amp.LOG.debug("Main.onExtension " + objExtPt + " [" + arrExts + "]");
    var id = objExtPt.getLocalId();

    if (id == "progress") {
      objExtPt.processExts(null, arrExts).each(jsx3.$F(function(arv) {
        arv.when(jsx3.$F(function(rv) {
          rv.setProgress(this._pctdone);
          this._progress.push(rv);
        }).bind(this));
      }).bind(this));
    } else if (id == "init") {
      jsx3.$A(arrExts).each(function(e) { e.getPlugIn().load(); });
    } else if (id == "layout") {
      jsx3.$A(arrExts).each(function(e) { e.getPlugIn().load(); });
    }
  };
  
  /** @private @jsxobf-clobber */
  Main_prototype._onProgress = function(objEvent) {
    this._pctdone = objEvent.pct;
//    this.getLog().debug("_onProgress " + objEvent.pct + " " + objEvent.done);

    var msg = objEvent.done ? "onComplete" : "setProgress";
    var pct = this._pctdone;
    this._progress.each(function(e) {
      e[msg](pct);
    });
  };
  
  Main_prototype.onStartup = function() {
    // Make sure that required plug-ins are loaded before doing this.
    this.loaded().when(jsx3.$F(function() {
      amp.LOG.debug("Main.onStartup");

      this.getExtPoint("init").processExts();

      var layouts = this.getExtPoint("layout").processExts();
      if (layouts.length > 0) {
        var container = this.getServer().getBodyBlock();
        layouts[0].when(function(rv) { rv(container); });
      }
    }).bind(this));
  };

});]]></data>
      </script>
    </resources>

    <!-- Any plug-in that wants to be notified of the plug-in initialization progress can register here. -->
    <extension-point id="progress" name="Initialization Progress Extension Point">
      <!-- This should return an object with the following methods:
             setProgress(pct : Number) : void
             onComplete(pct : Number) : void
          -->
      <processor type="return-async"/>
    </extension-point>

    <!-- Any code that needs to run at application initialization can register with this extension point. -->
    <extension-point id="init" name="Initialization Extension Point">
      <processor type="eval"/>
    </extension-point>

    <!-- Exactly one plug-in should extend this point to provide the default component file to paint. -->
    <extension-point id="layout" name="Main Component Extension Point">
      <!-- This should return a function with the following signature:
           function(parent : jsx3.app.Model)  
          -->
      <processor type="return-async"/>
    </extension-point>

  </plugin>

  <plugin class="jsx3.amp.AutoReg" id="jsx3.amp.autoreg" name="Plug-In Auto-Registration Plug-In" version="0.1">

    <resources>
      <script id="js" load="early">
        <data><![CDATA[/*
 * Copyright (c) 2001-2009, TIBCO Software Inc.
 * Use, modification, and distribution subject to terms of license.
 */

/**
 * @package
 */
jsx3.lang.Class.defineClass("jsx3.amp.AutoReg", jsx3.amp.PlugIn, null, function(AutoReg, AutoReg_prototype) {

  var amp = jsx3.amp;

  AutoReg.DIR = "plugins_auto";

  AutoReg_prototype.hasProvider = function() {
    return this._hasProvider;
  };

  AutoReg_prototype.hasCompleted = function() {
    return this._done;
  };

  AutoReg_prototype.onRegister = function() {
    this._hasProvider = false;
    this._done = false;
    this._uri = jsx3.app.Browser.getLocation().resolve(this.getServer().resolveURI(AutoReg.DIR + "/"));
  };

  AutoReg_prototype.onExtension = function(objExtPt, arrExts) {
    this.jsxsuper(objExtPt, arrExts);

    if (objExtPt.getLocalId() == "dirlist") {
      if (!this._hasProvider) {
        for (var i = 0; i < arrExts.length; i++) {
          var x = arrExts[i];
          if (x.isAvailable(this._uri.getScheme())) {
            this._hasProvider = true;
            this._loadWith(x);
            break;
          }
        }
      }
    }
  };

  AutoReg_prototype._loadWith = function(ext) {
    ext.getPlugIn().load().when(jsx3.$F(function() {
      var dirNames = ext.getDirNames(this._uri);
      dirNames = dirNames.filter(function(e) { return e.match(/^([\w\-]+)(\.[\w\-]+)*$/); });

      dirNames.each(jsx3.$F(function(e) {
        this.getEngine().register(e, this._uri);
      }).bind(this));

      this._done = true;
      this.publish({subject:"done"});
    }).bind(this));
  };

});]]></data>
      </script>
    </resources>

    <!-- Fired after this plug-in has registered all auto-registering plug-ins. -->
    <event id="done"/>

    <extension-point id="dirlist" name="Provide Directory Listing">
      <!-- Any extension should define the following methods:
             isAvailable(scheme : String) : boolean
             getDirNames(baseURI : jsx3.net.URI) : Array<String>
          -->
    </extension-point>
  </plugin>

  <plugin id="jsx3.amp.persist" name="Data Persistance Plug-In" version="0.1">

    <method id="getFirstProvider">
      return this.getExtPoint("provider").getExts().find(function(e) { return e.isAvailable(); });
    </method>

    <extension-point id="provider" name="Provide Persistance">
      <!-- Any extension should define the following methods:
             isAvailable() : boolean
             get(k : String) : String
             put(k : String, v : String) : void
             remove(k : String) : void
          -->
    </extension-point>

    <extension id="cookie" point="jsx3.amp.persist.provider">
      <method id="_getKey" params="k">
        return "com_tibco_gi_amp_persist_" + k;
      </method>

      <method id="isAvailable">
        var s = this.getPlugIn().getServer();
        var k = this._getKey("__test"), v = "foobar";
        s.setCookie(k, v);
        var ok = s.getCookie(k) == v;
        s.deleteCookie(k);
        return ok;
      </method>

      <method id="get" params="k">
        var s = this.getPlugIn().getServer();
        return s.getCookie(this._getKey(k));
      </method>

      <method id="put" params="k, v">
        var s = this.getPlugIn().getServer();
        s.deleteCookie(this._getKey(k));
        var now = new Date();
        s.setCookie(this._getKey(k), v, new Date(now.getFullYear() + 1, now.getMonth(), now.getDate()));
      </method>

      <method id="remove" params="k">
        var s = this.getPlugIn().getServer();
        s.deleteCookie(this._getKey(k));
      </method>
    </extension>
  </plugin>

  <plugin id="jsx3.amp.util.menumgr" name="MenuManager Plug-In" version="0.1">
    <requires>
      <plugin id="jsx3.gui.Menu"/>
    </requires>
    <resources>
      <script id="js" path="MenuManager.js"/>
    </resources>
  </plugin>

  <plugin id="jsx3.amp.util.toolbarmgr" name="ToolbarManager Plug-In" version="0.1">
    <requires>
      <plugin id="jsx3.gui.ToolbarButton"/>
    </requires>
    <resources>
      <script id="js" path="ToolbarManager.js"/>
    </resources>
  </plugin>

  <plugin global="true" id="jsx3.amp.util.prefspanel" name="PrefsPane Plug-In" property="jsx3.amp.util.PrefsPane.PLUGIN" version="0.1">
    <resources>
      <script id="js" path="PrefsController.js"/>
      <xml id="controller" path="controller.xml"/>
    </resources>
  </plugin>

  <plugin global="true" id="jsx3.amp.util.wizard" name="Wizard Plug-In" property="jsx3.amp.util.Wizard.PLUGIN" version="0.1">
    <resources>
      <script id="js" path="Wizard.js"/>
      <xml id="controller" path="controller.xml"/>
    </resources>
  </plugin>

</plugins>
